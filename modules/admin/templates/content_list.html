{% extends "struc.html" %}

{% block title %}Manage Content{% endblock %}
{% block page_title %}Manage Content{% endblock %}
{% block breadcrumb %}Manage Content{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('admin.static', filename='dashboard_content.css') }}"/>
{% endblock %}

{% block content %}
<script src="{{ url_for('admin.static', filename='dashboard_content.js') }}" defer></script>

<div class="dashboard-content fade-in">

  <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for c, m in messages %}
            <div class="flash {{ c }}">
              <i class="fas fa-{% if c == 'success' %}check-circle{% elif c == 'error' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
              {{ m }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}


     <!-- Top Bar -->
  <div class="topbar">
    <h2>All Content Items</h2>
    <a class="btn" href="{{ url_for('admin.admin_content_new') }}">
      <i class="fas fa-plus"></i> New Content
    </a>
  </div>

  <!-- Content Table -->
  <div class="table-section">
    <div class="table-header">
      <div style="display: flex; align-items: center;">
        <h3 class="table-title">Content Items</h3>
        <div class="table-count">
        </div>
      </div>
      
      <!-- Filters moved to right side of table header -->
      <form class="table-filters" method="get" action="/admin/content">
        <div class="filter-group">
          <select name="kind">
            <option value="">All types</option>
            <option value="update">Law Updates</option>
            <option value="document">Documents</option>
            <option value="news">News</option>
            <option value="image">Images</option>
          </select>
        </div>
        
        <div class="filter-group">
          <input type="text" name="q" placeholder="Search title or summary..." value="">
        </div>
        
        <div class="filter-group">
          <button type="submit" class="btn">
            <i class="fas fa-search"></i> Filter
          </button>
        </div>
      </form>
    </div>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th style="width: 60px;">ID</th>
            <th style="width: 100px;">Type</th>
            <th style="width: 250px;">Title</th>
            <th style="width: 100px;">Preview</th>
            <th style="width: 100px;">Document</th>
            <th style="width: 120px;">Published</th>
            <th style="width: 120px;">Created</th>
            <th style="width: 200px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if items|length == 0 %}
            <tr>
              <td colspan="8" class="empty-state">
                <i class="fas fa-file-alt"></i>
                <div>No content found matching your criteria.</div>
              </td>
            </tr>
          {% else %}
            {% for it in items %}
              <tr>
                <td data-label="ID">
                  <span class="appointment-id">{{ it.id }}</span>
                </td>
                <td data-label="Type">
                  <span class="badge {{ it.kind }}">
                    <i class="fas fa-{% if it.kind == 'update' %}gavel{% elif it.kind == 'document' %}file-pdf{% elif it.kind == 'news' %}newspaper{% else %}image{% endif %}"></i>
                    {{ it.kind|capitalize }}
                  </span>
                </td>
                <td data-label="Title">
                  <div class="lawyer-name">{{ it.title }}</div>
                  {% if it.summary %}
                    <span class="muted">{{ it.summary|truncate(100) }}</span>
                  {% endif %}
                </td>
                <td data-label="Preview">
                  {% if it.image_path %}
                    <img class="thumb" src="{{ url_for('admin.static', filename=it.image_path) }}" alt="Content preview">
                  {% else %}
                    <span class="muted">No image</span>
                  {% endif %}
                </td>
                <td data-label="Document">
                  {% if it.doc_path %}
                    <a class="btn" href="{{ url_for('admin.static', filename=it.doc_path) }}" target="_blank" style="padding: 6px 10px; font-size: 12px;">
                      <i class="fas fa-external-link-alt"></i> Open
                    </a>
                  {% elif it.external_link %}
                    <a class="btn" href="{{ it.external_link }}" target="_blank" style="padding: 6px 10px; font-size: 12px;">
                      <i class="fas fa-external-link-alt"></i> Link
                    </a>
                  {% else %}
                    <span class="muted">None</span>
                  {% endif %}
                </td>
                <td data-label="Published">
                  <span class="muted">{{ it.published_at or 'Not published' }}</span>
                </td>
                <td data-label="Created">
                  {{ it.created_at }}
                </td>
                <td data-label="Actions">
                  <div class="actions">
                    <a class="btn" href="{{ url_for('admin.admin_content_view', content_id=it.id) }}" style="padding: 6px 10px; font-size: 12px;">
                      <i class="fas fa-eye"></i> View
                    </a>
                    <a class="btn secondary" href="{{ url_for('admin.admin_content_edit', content_id=it.id) }}" style="padding: 6px 10px; font-size: 12px;">
                      <i class="fas fa-edit"></i> Edit
                    </a>
                    <form method="post" action="{{ url_for('admin.admin_content_delete', content_id=it.id) }}" onsubmit="return confirm('Are you sure you want to delete this content? This action cannot be undone.');" style="display:inline">
                      <button class="btn danger" type="submit" style="padding: 6px 10px; font-size: 12px;">
                        <i class="fas fa-trash"></i> Delete
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            {% endfor %}
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}