{% extends "strucl.html" %}

{% block title %}Manage Profile{% endblock %}
{% block page_title %}Manage Profile{% endblock %}
{% block breadcrumb %}Manage Profile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('lawyer.static', filename='lawyer_profile.css') }}"/>
{% endblock %}

{% block content %}
<script src="{{ url_for('lawyer.static', filename='lawyer_profile.js') }}" defer></script>

<div class="dashboard-content fade-in">


    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for c,m in messages %}
          <div class="flash {{ c }}">
            <i class="fas fa-{{ 'check-circle' if c == 'success' else 'exclamation-triangle' }}"></i>
            {{ m }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form class="main-card" method="post" enctype="multipart/form-data" action="{{ url_for('lawyer.lawyer_profile') }}">
      <div class="card-header">
        <h2>
          <i class="fas fa-edit"></i>
          Profile Information
        </h2>
      </div>

      <div class="card-body">
        <div class="form-grid">
          <!-- Left Column -->
          <div>
            <div class="section">
              <h3 class="section-title">
                <i class="fas fa-user"></i>
                Personal Information
              </h3>

              <div class="form-group">
                <label class="form-label required">Full Name</label>
                <input class="form-input" name="full_name" value="{{ me.full_name }}" required>
              </div>

              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label required">Email Address</label>
                  <input class="form-input" name="email" type="email" value="{{ me.email }}" required>
                </div>
                <div class="form-group">
                  <label class="form-label required">Phone Number</label>
                  <input class="form-input" name="phone" value="{{ me.phone }}" required>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label required">Address</label>
                <input class="form-input" name="address" value="{{ me.address }}" required>
              </div>

              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label required">NIC Number</label>
                  <input class="form-input" name="nic" value="{{ me.nic }}" required>
                </div>
                <div class="form-group">
                  <label class="form-label required">BAR / Register No.</label>
                  <input class="form-input" name="register_no" value="{{ me.register_no }}" required>
                </div>
              </div>

              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label required">Law Specialization</label>
                  <input class="form-input" name="law_side" value="{{ me.law_side }}" placeholder="e.g., Criminal, Civil, Family" required>
                </div>
                <div class="form-group">
                  <label class="form-label required">Username</label>
                  <input class="form-input" name="username" value="{{ me.username }}" required>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Professional Notes</label>
                <textarea class="form-input form-textarea" name="lawyer_note" placeholder="Brief bio, languages spoken, courts you practice in, notable achievements...">{{ me.lawyer_note }}</textarea>
                <div class="help-text">
                  <i class="fas fa-info-circle"></i>
                  This information will be visible to potential clients
                </div>
              </div>

              <div class="checkbox-group">
                <input class="checkbox" type="checkbox" id="status" name="status" {% if me.status==1 %}checked{% endif %}>
                <label for="status" class="form-label">Profile is active and visible to clients</label>
              </div>

              <div class="status-indicator {% if me.status==1 %}status-active{% else %}status-inactive{% endif %}">
                <i class="fas fa-{{ 'check-circle' if me.status==1 else 'times-circle' }}"></i>
                {% if me.status==1 %}Active Profile{% else %}Inactive Profile{% endif %}
              </div>
            </div>

            <div class="divider"></div>

            <div class="section">
              <h3 class="section-title">
                <i class="fas fa-calendar-alt"></i>
                Availability Schedule
              </h3>

              <div class="form-group">
                <label class="form-label required">Available Days</label>
                <div class="days-grid">
                  {% for d in DAYS %}
                    <label class="day-item" onclick="toggleDay(this)">
                      <input type="checkbox" name="days" value="{{ d }}" {% if d in me.days %}checked{% endif %} style="display: none;">
                      <i class="fas fa-calendar-day"></i>
                      {{ d }}
                    </label>
                  {% endfor %}
                </div>
              </div>

              <div class="form-group">
                <label class="form-label required">Availability Schedule</label>
                <div class="time-slots-container">
                  <!-- Weekdays Time Slots -->
                  <div class="time-slot-group">
                    <h4 class="slot-group-title">
                      <i class="fas fa-clock"></i>
                      Weekdays Time Slots
                    </h4>
                    <div class="time-slots">
                      <label class="time-slot-item">
                        <input type="radio" name="weekday_slot" value="morning">
                        <div class="slot-content">
                          <div class="slot-title">Morning (8:00 AM - 12:00 PM)</div>
                        </div>
                      </label>
                      <label class="time-slot-item">
                        <input type="radio" name="weekday_slot" value="afternoon">
                        <div class="slot-content">
                          <div class="slot-title">Afternoon (12:00 PM - 4:00 PM)</div>
                        </div>
                      </label>
                      <label class="time-slot-item">
                        <input type="radio" name="weekday_slot" value="fullday">
                        <div class="slot-content">
                          <div class="slot-title">Full Day (8:00 AM - 4:00 PM)</div>
                        </div>
                      </label>
                      <label class="time-slot-item">
                        <input type="radio" name="weekday_slot" value="evening">
                        <div class="slot-content">
                          <div class="slot-title">Evening (4:00 PM - 8:00 PM)</div>
                        </div>
                      </label>
                    </div>
                  </div>

                  <!-- Weekend Time Slots -->
                  <div class="time-slot-group">
                    <h4 class="slot-group-title">
                      <i class="fas fa-clock"></i>
                      Weekend Time Slots
                    </h4>
                    <div class="time-slots">
                      <label class="time-slot-item">
                        <input type="radio" name="weekend_slot" value="morning">
                        <div class="slot-content">
                          <div class="slot-title">Morning (8:00 AM - 12:00 PM)</div>
                        </div>
                      </label>
                      <label class="time-slot-item">
                        <input type="radio" name="weekend_slot" value="afternoon">
                        <div class="slot-content">
                          <div class="slot-title">Afternoon (12:00 PM - 4:00 PM)</div>
                        </div>
                      </label>
                      <label class="time-slot-item">
                        <input type="radio" name="weekend_slot" value="fullday">
                        <div class="slot-content">
                          <div class="slot-title">Full Day (8:00 AM - 4:00 PM)</div>
                        </div>
                      </label>
                      <label class="time-slot-item">
                        <input type="radio" name="weekend_slot" value="evening">
                        <div class="slot-content">
                          <div class="slot-title">Evening (4:00 PM - 8:00 PM)</div>
                        </div>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Time slot data for backend -->
                <input type="hidden" name="weekday_slot" id="weekday_slot_hidden" value="">
                <input type="hidden" name="weekend_slot" id="weekend_slot_hidden" value="">
                <input type="hidden" name="avb_time_text" id="avb_time_text" value="{{ me.avb_time_text }}">

                <div class="form-group" style="margin-top: 20px;">
                  <label class="form-label">Additional Notes</label>
                  <textarea class="form-input form-textarea" name="additional_notes" placeholder="Special arrangements, emergency availability, holiday schedules..." style="min-height: 80px;">{{ me.additional_notes or '' }}</textarea>
                  <div class="help-text">
                    <i class="fas fa-info-circle"></i>
                    Optional: Add any special scheduling notes or exceptions
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div>
            <div class="section">
              <h3 class="section-title">
                <i class="fas fa-image"></i>
                Profile Photo
              </h3>

              <div class="photo-section">
                <div class="avatar-container">
                  <img class="avatar" src="{{ me.photo or 'https://dummyimage.com/240x240/e2e8f0/64748b&text=No+Photo' }}" alt="Profile Photo">
                </div>
                <div class="photo-upload">
                  <div class="form-group">
                    <label class="form-label">Upload New Photo</label>
                    <div class="file-input-wrapper">
                      <input class="file-input" type="file" name="lawyer_img" accept=".png,.jpg,.jpeg,.gif,.webp">
                      <div class="file-input-label">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Choose Photo
                      </div>
                    </div>
                    <div class="help-text">
                      <i class="fas fa-info-circle"></i>
                      PNG, JPG, GIF, or WEBP. Max 5MB. Professional headshot recommended.
                    </div>
                  </div>

                  {% if me.photo %}
                    <div class="checkbox-group">
                      <input class="checkbox" type="checkbox" id="remove_photo" name="remove_photo">
                      <label for="remove_photo" class="form-label">Remove current photo</label>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="section">
              <h3 class="section-title">
                <i class="fas fa-shield-alt"></i>
                Security Settings
              </h3>

              <div class="form-group">
                <label class="form-label">New Password</label>
                <input class="form-input" type="password" name="new_password" minlength="6" placeholder="Leave blank to keep current password">
                <div class="help-text">
                  <i class="fas fa-key"></i>
                  Minimum 6 characters required
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Confirm New Password</label>
                <input class="form-input" type="password" name="confirm_password" minlength="6" placeholder="Repeat new password">
              </div>
            </div>
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" type="submit" onclick="prepareFormData()">
            <i class="fas fa-save"></i>
            Save Changes
          </button>
          <a class="btn btn-secondary" href="{{ url_for('lawyer.lawyer_profile') }}">
            <i class="fas fa-times"></i>
            Cancel
          </a>
        </div>
      </div>
    </form>
  </div>
  {% endblock %}